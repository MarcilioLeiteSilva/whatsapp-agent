{% extends "base.html" %}
{% block content %}

<style>
  .page-wrap { max-width: 1100px; margin: 0 auto; padding: 16px 18px; }
  .page-head { display:flex; align-items:flex-start; justify-content:space-between; gap:12px; flex-wrap: wrap; }
  .muted { opacity:.75; font-size: 13px; }
  .grid { display:grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  .grid-1 { display:grid; grid-template-columns: 1fr; gap: 14px; }
  @media (max-width: 980px){ .grid { grid-template-columns: 1fr; } }
  .label { font-weight: 600; font-size: 13px; margin-bottom: 6px; }
  textarea.codebox { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
</style>

<div class="page-wrap">
  <div class="page-head">
    <div>
      <h2 style="margin:0;">‚ûï Inserir Template</h2>
      <div class="muted">Crie um template de regras para reutilizar na instala√ß√£o de agentes.</div>
    </div>

    <div style="display:flex; gap:10px; align-items:center;">
      <a href="{{ back_url }}" class="btn btn-secondary">‚Üê Voltar</a>
      <button form="tplForm" type="submit" class="btn btn-primary">üíæ Salvar</button>
    </div>
  </div>

  {% if flash %}
    <div class="alert alert-{{ flash.kind }}" style="margin-top:12px;">
      {{ flash.message }}
    </div>
  {% endif %}

  <form id="tplForm" method="post" action="{{ create_action }}" style="margin-top:12px;">
    <div class="grid">
      <div class="card">
        <div class="card-body">
          <h4 style="margin-top:0;">üìå Identifica√ß√£o</h4>

          <div class="grid">
            <div>
              <div class="label">Nome*</div>
              <input name="name" class="form-control" required value="{{ form.name or '' }}" placeholder="Ex.: Cl√≠nica Veterin√°ria (Atendimento)"/>
            </div>

            <div>
              <div class="label">Tipo</div>
              <input name="kind" class="form-control" value="{{ form.kind or '' }}" placeholder="Ex.: Vendas / Informa√ß√µes / Suporte"/>
            </div>

            <div>
              <div class="label">Nicho</div>
              <input name="niche" class="form-control" value="{{ form.niche or '' }}" placeholder="Ex.: Veterin√°ria / Viagens / Placas"/>
            </div>

            <div>
              <div class="label">Descri√ß√£o</div>
              <input name="description" class="form-control" value="{{ form.description or '' }}" placeholder="Breve descri√ß√£o do fluxo"/>
            </div>
          </div>

          <div class="muted" style="margin-top:10px;">
            Dica: use <b>Nicho</b> para o segmento e <b>Tipo</b> para a inten√ß√£o do fluxo (vendas/suporte/info).
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-body">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
            <h4 style="margin:0;">üß© JSON de Regras*</h4>
            <div class="muted">Cole um JSON v√°lido (dict)</div>
          </div>

          <textarea
            name="rules_text"
            class="form-control codebox"
            rows="22"
            required
            style="margin-top:10px; resize: vertical;"
            placeholder='{"branding": {"name": "Atendimento"}, ... }'
          >{{ rules_text or example_json }}</textarea>

          <div class="muted" style="margin-top:10px;">
            Esse JSON ser√° aplicado copiando o conte√∫do para <code>agents.rules_json</code>.
          </div>
        </div>
      </div>
    </div>
  </form>
</div>

{% endblock %}
